<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈÄöÁü•Á≥ªÁªü API ÊµãËØïÂ∑•ÂÖ∑ V2 - Modern UI</title>
    
    <!-- React and Babel from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Modern UI Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1f2937;
            --light: #f9fafb;
            --border: #e5e7eb;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Glass morphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
        
        .glass-dark {
            background: rgba(31, 41, 55, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
        }
        
        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* Modern button styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            font-weight: 600;
            font-size: 16px;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: none;
            position: relative;
            overflow: hidden;
            gap: 8px;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:active::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 15px 0 rgba(99, 102, 241, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px 0 rgba(99, 102, 241, 0.4);
        }
        
        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 2px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: var(--light);
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* Modern input styles */
        .input-group {
            position: relative;
            margin-bottom: 24px;
        }
        
        .input-group label {
            position: absolute;
            top: -8px;
            left: 16px;
            background: white;
            padding: 0 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
            transition: all 0.3s;
            z-index: 1;
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }
        
        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
        
        /* Modern card styles */
        .card {
            background: white;
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .card:hover {
            box-shadow: 0 20px 60px -10px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        
        /* Tab navigation */
        .tab-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            padding: 8px;
            background: var(--light);
            border-radius: 16px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 24px;
            border-radius: 12px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab-btn:hover {
            color: var(--primary);
        }
        
        .tab-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.1);
        }
        
        /* Status badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 9999px;
            font-size: 14px;
            font-weight: 600;
            gap: 6px;
        }
        
        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }
        
        .badge-error {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }
        
        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }
        
        .badge-info {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
        }
        
        /* Floating action button */
        .fab {
            position: fixed;
            bottom: 32px;
            right: 32px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 24px -4px rgba(99, 102, 241, 0.4);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 32px -4px rgba(99, 102, 241, 0.5);
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 32px;
            right: 32px;
            transform: translateX(400px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 9999;
            max-width: 400px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast-content {
            background: white;
            border-radius: 12px;
            padding: 16px 24px;
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid var(--primary);
        }
        
        .toast-success .toast-content {
            border-left-color: var(--success);
        }
        
        .toast-error .toast-content {
            border-left-color: var(--danger);
        }
        
        /* Loading spinner */
        .spinner {
            width: 40px;
            height: 40px;
            position: relative;
        }
        
        .spinner::before,
        .spinner::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid transparent;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }
        
        .spinner::after {
            border-top-color: var(--secondary);
            animation-delay: 0.5s;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Skeleton loader */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.2s ease-in-out infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Toggle switch */
        .toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        .toggle input:checked + .toggle-slider {
            background-color: var(--primary);
        }
        
        .toggle input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .card {
                padding: 24px;
            }
            
            .tab-nav {
                gap: 4px;
                padding: 4px;
            }
            
            .tab-btn {
                padding: 8px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef, useMemo } = React;
        
        // API configuration
        const PRODUCTION_URL = 'https://notification.caas.xyz';
        
        // Icons
        const Icon = ({ name, className = '' }) => {
            return <i className={`fas fa-${name} ${className}`}></i>;
        };
        
        // Toast Component
        function Toast({ message, type = 'info', show, onClose }) {
            useEffect(() => {
                if (show) {
                    const timer = setTimeout(() => {
                        onClose();
                    }, 3000);
                    return () => clearTimeout(timer);
                }
            }, [show, onClose]);
            
            return (
                <div className={`toast ${show ? 'show' : ''} toast-${type}`}>
                    <div className="toast-content">
                        <Icon name={type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : 'info-circle'} />
                        <span>{message}</span>
                    </div>
                </div>
            );
        }
        
        // Loading Spinner Component
        function LoadingSpinner({ size = 'default' }) {
            return (
                <div className={`spinner ${size === 'small' ? 'w-6 h-6' : ''}`}></div>
            );
        }
        
        // JSON Editor Component with Syntax Highlighting
        function JsonEditor({ value, onChange, placeholder, rows = 6 }) {
            const [isValid, setIsValid] = useState(true);
            const [formatted, setFormatted] = useState(value);
            
            const handleChange = (e) => {
                const newValue = e.target.value;
                setFormatted(newValue);
                onChange(newValue);
                
                try {
                    if (newValue.trim()) {
                        JSON.parse(newValue);
                        setIsValid(true);
                    }
                } catch {
                    setIsValid(false);
                }
            };
            
            const formatJson = () => {
                try {
                    const parsed = JSON.parse(formatted);
                    const pretty = JSON.stringify(parsed, null, 2);
                    setFormatted(pretty);
                    onChange(pretty);
                    setIsValid(true);
                } catch {
                    setIsValid(false);
                }
            };
            
            return (
                <div className="relative">
                    <textarea
                        value={formatted}
                        onChange={handleChange}
                        placeholder={placeholder}
                        rows={rows}
                        className={`w-full p-4 font-mono text-sm border-2 rounded-lg transition-all ${
                            isValid ? 'border-gray-300 focus:border-indigo-500' : 'border-red-400'
                        }`}
                        style={{ resize: 'vertical' }}
                    />
                    <button
                        type="button"
                        onClick={formatJson}
                        className="absolute top-2 right-2 px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-md transition-colors"
                    >
                        <Icon name="code" className="mr-1" />
                        Ê†ºÂºèÂåñ
                    </button>
                    {!isValid && (
                        <p className="mt-1 text-sm text-red-600">
                            <Icon name="exclamation-circle" className="mr-1" />
                            JSON Ê†ºÂºèÊó†Êïà
                        </p>
                    )}
                </div>
            );
        }
        
        // Response Display Component
        function ResponseDisplay({ data, status }) {
            const [copied, setCopied] = useState(false);
            
            const handleCopy = async () => {
                try {
                    await navigator.clipboard.writeText(data || '');
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (err) {
                    console.error('Failed to copy:', err);
                }
            };
            
            const formatJSON = (jsonString) => {
                if (!jsonString) return 'ÂìçÂ∫îÁªìÊûúÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫...';
                
                try {
                    const obj = JSON.parse(jsonString);
                    return JSON.stringify(obj, null, 2);
                } catch {
                    return jsonString;
                }
            };
            
            return (
                <div className="relative">
                    <div className="absolute top-4 right-4 flex gap-2">
                        {status && (
                            <span className={`badge ${status >= 200 && status < 300 ? 'badge-success' : 'badge-error'}`}>
                                <Icon name={status >= 200 && status < 300 ? 'check' : 'times'} />
                                {status}
                            </span>
                        )}
                        {data && (
                            <button
                                onClick={handleCopy}
                                className={`btn btn-secondary py-2 px-4 text-sm ${copied ? 'bg-green-500 text-white' : ''}`}
                            >
                                <Icon name={copied ? 'check' : 'copy'} />
                                {copied ? 'Â∑≤Â§çÂà∂' : 'Â§çÂà∂'}
                            </button>
                        )}
                    </div>
                    <pre className="bg-gray-50 p-6 rounded-lg overflow-auto max-h-96 font-mono text-sm">
                        {formatJSON(data)}
                    </pre>
                </div>
            );
        }
        
        // Channel Selector Component
        function ChannelSelector({ selectedChannels, onChange }) {
            const channels = [
                { id: 'webhook', name: 'Webhook', icon: 'link', color: 'text-blue-600' },
                { id: 'telegram', name: 'Telegram', icon: 'paper-plane', color: 'text-sky-600' },
                { id: 'lark', name: 'È£û‰π¶/Lark', icon: 'comments', color: 'text-green-600' },
                { id: 'slack', name: 'Slack', icon: 'hashtag', color: 'text-purple-600' }
            ];
            
            return (
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    {channels.map(channel => (
                        <label
                            key={channel.id}
                            className={`relative flex items-center justify-center p-4 rounded-xl border-2 cursor-pointer transition-all ${
                                selectedChannels.includes(channel.id)
                                    ? 'border-indigo-500 bg-indigo-50'
                                    : 'border-gray-300 hover:border-gray-400'
                            }`}
                        >
                            <input
                                type="checkbox"
                                className="sr-only"
                                checked={selectedChannels.includes(channel.id)}
                                onChange={() => onChange(channel.id)}
                            />
                            <div className="text-center">
                                <Icon name={channel.icon} className={`text-2xl mb-2 ${channel.color}`} />
                                <span className="text-sm font-medium">{channel.name}</span>
                            </div>
                            {selectedChannels.includes(channel.id) && (
                                <div className="absolute top-2 right-2">
                                    <Icon name="check-circle" className="text-indigo-500" />
                                </div>
                            )}
                        </label>
                    ))}
                </div>
            );
        }
        
        // Quick Fill Buttons Component
        function QuickFillButtons({ options, onSelect }) {
            return (
                <div className="flex flex-wrap gap-2 mt-2">
                    {options.map((option, index) => (
                        <button
                            key={index}
                            type="button"
                            onClick={() => onSelect(option.value)}
                            className="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded-full transition-colors"
                        >
                            {option.label}
                        </button>
                    ))}
                </div>
            );
        }
        
        // Main App Component
        function App() {
            const [activeTab, setActiveTab] = useState('send');
            const [environment, setEnvironment] = useState(() => {
                return localStorage.getItem('environment') || 'local';
            });
            const [apiSecret, setApiSecret] = useState(() => {
                const currentEnv = localStorage.getItem('environment') || 'local';
                if (currentEnv === 'production') {
                    return localStorage.getItem('api_secret_production') || '';
                } else {
                    return localStorage.getItem('api_secret_local') || 'test-secret-key-for-development';
                }
            });
            const [baseUrl, setBaseUrl] = useState(() => {
                const currentEnv = localStorage.getItem('environment') || 'local';
                return currentEnv === 'production' ? PRODUCTION_URL : window.location.origin;
            });
            const [response, setResponse] = useState({ data: null, status: null });
            const [loading, setLoading] = useState(false);
            const [toast, setToast] = useState({ show: false, message: '', type: 'info' });
            
            // Form states
            const [userId, setUserId] = useState('test-user');
            const [selectedChannels, setSelectedChannels] = useState(['webhook']);
            const [sendMethod, setSendMethod] = useState('custom');
            const [subject, setSubject] = useState('');
            const [content, setContent] = useState('ËøôÊòØ‰∏ÄÊù°ÊµãËØïÈÄöÁü• üîî');
            const [templateKey, setTemplateKey] = useState('');
            const [variables, setVariables] = useState('{}');
            const [idempotencyKey, setIdempotencyKey] = useState('');
            const [templates, setTemplates] = useState([]);
            const [templatesData, setTemplatesData] = useState({});
            
            // Show toast notification
            const showToast = (message, type = 'info') => {
                setToast({ show: true, message, type });
            };
            
            // Handle environment change
            const handleEnvironmentChange = (env) => {
                if (env === 'production') {
                    if (confirm('‚ö†Ô∏è Ê≥®ÊÑèÔºöÊÇ®Âç≥Â∞ÜÂàáÊç¢Âà∞Ê≠£ÂºèÁéØÂ¢ÉÔºÅ\n\nËØ∑Á°Æ‰øùÔºö\n1. ‰ΩøÁî®Ê≠£Á°ÆÁöÑÊ≠£ÂºèÁéØÂ¢É API ÂØÜÈí•\n2. Ë∞®ÊÖéÊìç‰ΩúÔºåÈÅøÂÖçÂèëÈÄÅÊµãËØïÊï∞ÊçÆ\n\nÊòØÂê¶ÁªßÁª≠Ôºü')) {
                        setEnvironment('production');
                        localStorage.setItem('environment', 'production');
                        setBaseUrl(PRODUCTION_URL);
                        const prodSecret = localStorage.getItem('api_secret_production') || '';
                        setApiSecret(prodSecret);
                        showToast('Â∑≤ÂàáÊç¢Âà∞Ê≠£ÂºèÁéØÂ¢É', 'warning');
                    }
                } else {
                    setEnvironment('local');
                    localStorage.setItem('environment', 'local');
                    setBaseUrl(window.location.origin);
                    const localSecret = localStorage.getItem('api_secret_local') || 'test-secret-key-for-development';
                    setApiSecret(localSecret);
                    showToast('Â∑≤ÂàáÊç¢Âà∞Êú¨Âú∞ÁéØÂ¢É', 'success');
                }
            };
            
            // Generate signature
            const generateSignature = async (timestamp, body, secretKey) => {
                const encoder = new TextEncoder();
                const key = await crypto.subtle.importKey(
                    'raw',
                    encoder.encode(secretKey),
                    { name: 'HMAC', hash: 'SHA-256' },
                    false,
                    ['sign']
                );
                
                const signature = await crypto.subtle.sign(
                    'HMAC',
                    key,
                    encoder.encode(timestamp + body)
                );
                
                return Array.from(new Uint8Array(signature))
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join('');
            };
            
            // Generate signature for GET/DELETE requests
            const generateGetSignature = async (timestamp, url, secretKey) => {
                const urlObj = new URL(url);
                const pathAndQuery = urlObj.pathname + urlObj.search;
                return generateSignature(timestamp, pathAndQuery, secretKey);
            };
            
            // Show response
            const showResponse = (data, status) => {
                const envInfo = environment === 'production' ? 
                    '‚ö†Ô∏è Ê≠£ÂºèÁéØÂ¢ÉÂìçÂ∫î\n' + '‚îÅ'.repeat(50) + '\n' : 
                    '‚úÖ Êú¨Âú∞ÁéØÂ¢ÉÂìçÂ∫î\n' + '‚îÅ'.repeat(50) + '\n';
                
                setResponse({
                    data: envInfo + JSON.stringify(data, null, 2),
                    status
                });
                
                if (status >= 200 && status < 300) {
                    showToast('ËØ∑Ê±ÇÊàêÂäü', 'success');
                } else {
                    showToast('ËØ∑Ê±ÇÂ§±Ë¥•', 'error');
                }
            };
            
            // Load templates
            const loadTemplates = useCallback(async () => {
                if (selectedChannels.length === 0) {
                    setTemplates([]);
                    return;
                }
                
                try {
                    const response = await fetch(baseUrl + '/api/templates');
                    const data = await response.json();
                    
                    if (data.success && data.data) {
                        const templatesMap = {};
                        data.data.forEach(template => {
                            templatesMap[template.template_key] = template;
                        });
                        setTemplatesData(templatesMap);
                        
                        // Filter templates that support all selected channels
                        const availableTemplates = data.data.filter(template => 
                            selectedChannels.every(channel => 
                                template.supported_channels && template.supported_channels.includes(channel)
                            )
                        );
                        
                        setTemplates(availableTemplates);
                        if (availableTemplates.length > 0) {
                            setTemplateKey(availableTemplates[0].template_key);
                        }
                    }
                } catch (error) {
                    console.error('Failed to load templates:', error);
                    setTemplates([]);
                }
            }, [selectedChannels, baseUrl]);
            
            // Send notification
            const sendNotification = async () => {
                setLoading(true);
                try {
                    const requestBody = {
                        user_id: userId,
                        channels: selectedChannels
                    };
                    
                    if (sendMethod === 'custom') {
                        requestBody.custom_content = {
                            content: content
                        };
                        if (subject) {
                            requestBody.custom_content.subject = subject;
                        }
                    } else {
                        requestBody.template_key = templateKey;
                        try {
                            const vars = JSON.parse(variables);
                            if (Object.keys(vars).length > 0) {
                                requestBody.variables = vars;
                            }
                        } catch (e) {
                            throw new Error('Ê®°ÊùøÂèòÈáèÂøÖÈ°ªÊòØÊúâÊïàÁöÑ JSON Ê†ºÂºè');
                        }
                    }
                    
                    if (idempotencyKey) {
                        requestBody.idempotency_key = idempotencyKey;
                    }
                    
                    const timestamp = Date.now().toString();
                    const body = JSON.stringify(requestBody);
                    const signature = await generateSignature(timestamp, body, apiSecret);
                    
                    const response = await fetch(baseUrl + '/api/notifications/send', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Timestamp': timestamp,
                            'X-Signature': signature
                        },
                        body: body
                    });
                    
                    const data = await response.json();
                    showResponse(data, response.status);
                } catch (error) {
                    showResponse({ error: error.message }, 400);
                } finally {
                    setLoading(false);
                }
            };
            
            // Channel checkbox handler
            const handleChannelChange = (channel) => {
                setSelectedChannels(prev => {
                    if (prev.includes(channel)) {
                        return prev.filter(c => c !== channel);
                    } else {
                        return [...prev, channel];
                    }
                });
            };
            
            // Load templates when channels change
            useEffect(() => {
                if (sendMethod === 'template') {
                    loadTemplates();
                }
            }, [selectedChannels, sendMethod, loadTemplates]);
            
            // Tab configuration
            const tabs = [
                { id: 'send', name: 'ÂèëÈÄÅÈÄöÁü•', icon: 'paper-plane' },
                { id: 'userconfig', name: 'Áî®Êà∑ÈÖçÁΩÆ', icon: 'user-cog' },
                { id: 'templates', name: 'Ê®°ÊùøÁÆ°ÁêÜ', icon: 'file-alt' },
                { id: 'logs', name: 'ÈÄöÁü•Êó•Âøó', icon: 'history' },
                { id: 'health', name: 'ÂÅ•Â∫∑Ê£ÄÊü•', icon: 'heartbeat' },
                { id: 'metrics', name: 'Á≥ªÁªüÊåáÊ†á', icon: 'chart-line' },
                { id: 'grafana', name: 'Grafana', icon: 'chart-area' }
            ];
            
            // Tab components
            const tabComponents = {
                send: <SendNotificationTab 
                    userId={userId}
                    setUserId={setUserId}
                    selectedChannels={selectedChannels}
                    handleChannelChange={handleChannelChange}
                    sendMethod={sendMethod}
                    setSendMethod={setSendMethod}
                    subject={subject}
                    setSubject={setSubject}
                    content={content}
                    setContent={setContent}
                    templateKey={templateKey}
                    setTemplateKey={setTemplateKey}
                    templates={templates}
                    templatesData={templatesData}
                    variables={variables}
                    setVariables={setVariables}
                    idempotencyKey={idempotencyKey}
                    setIdempotencyKey={setIdempotencyKey}
                    sendNotification={sendNotification}
                    loading={loading}
                />,
                userconfig: <UserConfigTab baseUrl={baseUrl} showResponse={showResponse} apiSecret={apiSecret} generateGetSignature={generateGetSignature} generateSignature={generateSignature} showToast={showToast} />,
                templates: <TemplatesTab baseUrl={baseUrl} showResponse={showResponse} apiSecret={apiSecret} generateGetSignature={generateGetSignature} generateSignature={generateSignature} showToast={showToast} />,
                logs: <LogsTab baseUrl={baseUrl} showResponse={showResponse} apiSecret={apiSecret} generateGetSignature={generateGetSignature} generateSignature={generateSignature} showToast={showToast} />,
                health: <HealthTab baseUrl={baseUrl} showResponse={showResponse} showToast={showToast} />,
                metrics: <MetricsTab baseUrl={baseUrl} showResponse={showResponse} apiSecret={apiSecret} generateGetSignature={generateGetSignature} showToast={showToast} />,
                grafana: <GrafanaTab baseUrl={baseUrl} showResponse={showResponse} environment={environment} showToast={showToast} />
            };
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
                    <div className="container mx-auto px-4 py-8 max-w-7xl">
                        {/* Header */}
                        <div className={`glass rounded-2xl p-8 mb-8 ${environment === 'production' ? 'border-red-300' : ''}`}>
                            <div className="flex items-center justify-between flex-wrap gap-4">
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-800 flex items-center gap-3">
                                        <Icon name="rocket" className="text-indigo-600" />
                                        ÈÄöÁü•Á≥ªÁªü API ÊµãËØïÂ∑•ÂÖ∑
                                        <span className="badge badge-info">V2</span>
                                    </h1>
                                    <p className="text-gray-600 mt-2">
                                        {environment === 'production' ? 
                                            'üö® Ê≠£ÂºèÁéØÂ¢É - ËØ∑Ë∞®ÊÖéÊìç‰Ωú' : 
                                            'üõ†Ô∏è ÂºÄÂèëÁéØÂ¢É - ÂÆâÂÖ®ÊµãËØï'
                                        }
                                    </p>
                                </div>
                                <div className="flex items-center gap-4">
                                    <label className="toggle">
                                        <input
                                            type="checkbox"
                                            checked={environment === 'production'}
                                            onChange={(e) => handleEnvironmentChange(e.target.checked ? 'production' : 'local')}
                                        />
                                        <span className="toggle-slider"></span>
                                    </label>
                                    <span className="text-sm font-medium">
                                        {environment === 'production' ? 'Ê≠£ÂºèÁéØÂ¢É' : 'Êú¨Âú∞ÁéØÂ¢É'}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        {/* API Configuration */}
                        <div className="card mb-8 animate-slide-in">
                            <h2 className="text-xl font-bold mb-6 flex items-center gap-2">
                                <Icon name="cog" className="text-gray-600" />
                                API ÈÖçÁΩÆ
                            </h2>
                            <div className="grid md:grid-cols-2 gap-6">
                                <div className="input-group">
                                    <label>ÁéØÂ¢ÉÂú∞ÂùÄ</label>
                                    <input
                                        type="text"
                                        value={baseUrl}
                                        readOnly
                                        className="bg-gray-50"
                                    />
                                </div>
                                <div className="input-group">
                                    <label>API ÂØÜÈí•</label>
                                    <input
                                        type="password"
                                        value={apiSecret}
                                        onChange={(e) => {
                                            const newSecret = e.target.value;
                                            setApiSecret(newSecret);
                                            if (environment === 'production') {
                                                localStorage.setItem('api_secret_production', newSecret);
                                            } else {
                                                localStorage.setItem('api_secret_local', newSecret);
                                            }
                                        }}
                                        placeholder={environment === 'production' ? 'ËæìÂÖ•Ê≠£ÂºèÁéØÂ¢É API ÂØÜÈí•' : 'ËæìÂÖ• API ÂØÜÈí•'}
                                    />
                                </div>
                            </div>
                        </div>
                        
                        {/* Tab Navigation */}
                        <div className="tab-nav mb-8">
                            {tabs.map(tab => (
                                <button
                                    key={tab.id}
                                    className={`tab-btn ${activeTab === tab.id ? 'active' : ''}`}
                                    onClick={() => setActiveTab(tab.id)}
                                >
                                    <Icon name={tab.icon} />
                                    <span className="hidden md:inline">{tab.name}</span>
                                </button>
                            ))}
                        </div>
                        
                        {/* Tab Content */}
                        <div className="card mb-8 animate-fade-in">
                            {tabComponents[activeTab]}
                        </div>
                        
                        {/* Response Display */}
                        <div className="card animate-slide-in">
                            <h2 className="text-xl font-bold mb-6 flex items-center gap-2">
                                <Icon name="code" className="text-gray-600" />
                                ÂìçÂ∫îÁªìÊûú
                            </h2>
                            <ResponseDisplay data={response.data} status={response.status} />
                        </div>
                    </div>
                    
                    {/* Toast Notification */}
                    <Toast
                        message={toast.message}
                        type={toast.type}
                        show={toast.show}
                        onClose={() => setToast({ ...toast, show: false })}
                    />
                </div>
            );
        }
        
        // Send Notification Tab Component
        function SendNotificationTab(props) {
            const {
                userId, setUserId, selectedChannels, handleChannelChange,
                sendMethod, setSendMethod, subject, setSubject,
                content, setContent, templateKey, setTemplateKey,
                templates, templatesData, variables, setVariables,
                idempotencyKey, setIdempotencyKey, sendNotification, loading
            } = props;
            
            const userIdOptions = [
                { label: 'ÊµãËØïÁî®Êà∑', value: 'test-user' },
                { label: 'ÊºîÁ§∫Áî®Êà∑', value: 'demo-user' },
                { label: 'Rei (Lark)', value: 'rei' },
                { label: 'ÈöèÊú∫Áî®Êà∑', value: 'user-' + Date.now() }
            ];
            
            return (
                <div className="space-y-6">
                    <div className="flex items-center gap-2 text-sm text-gray-600 mb-4">
                        <span className="badge badge-success">POST</span>
                        <code className="bg-gray-100 px-2 py-1 rounded">/api/notifications/send</code>
                    </div>
                    
                    <div className="input-group">
                        <label>Áî®Êà∑ ID *</label>
                        <input
                            type="text"
                            value={userId}
                            onChange={(e) => setUserId(e.target.value)}
                            placeholder="ËæìÂÖ•Áî®Êà∑ ID"
                            required
                        />
                        <QuickFillButtons options={userIdOptions} onSelect={setUserId} />
                    </div>
                    
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-3">
                            ÈÄöÁü•Ê∏†ÈÅì * <span className="text-gray-500">ÈÄâÊã©‰∏Ä‰∏™ÊàñÂ§ö‰∏™Ê∏†ÈÅì</span>
                        </label>
                        <ChannelSelector
                            selectedChannels={selectedChannels}
                            onChange={handleChannelChange}
                        />
                    </div>
                    
                    <div className="input-group">
                        <label>ÂèëÈÄÅÊñπÂºè</label>
                        <select value={sendMethod} onChange={(e) => setSendMethod(e.target.value)}>
                            <option value="custom">Ëá™ÂÆö‰πâÂÜÖÂÆπ</option>
                            <option value="template">‰ΩøÁî®Ê®°Êùø</option>
                        </select>
                    </div>
                    
                    {sendMethod === 'custom' ? (
                        <>
                            <div className="input-group">
                                <label>‰∏ªÈ¢òÔºàÂèØÈÄâÔºâ</label>
                                <input
                                    type="text"
                                    placeholder="ÈÄöÁü•‰∏ªÈ¢ò"
                                    value={subject}
                                    onChange={(e) => setSubject(e.target.value)}
                                />
                            </div>
                            
                            <div className="input-group">
                                <label>ÂÜÖÂÆπ *</label>
                                <textarea
                                    placeholder="ÈÄöÁü•ÂÜÖÂÆπ"
                                    required
                                    value={content}
                                    onChange={(e) => setContent(e.target.value)}
                                    rows="4"
                                />
                            </div>
                        </>
                    ) : (
                        <>
                            <div className="input-group">
                                <label>Ê®°Êùø Key</label>
                                <select
                                    value={templateKey}
                                    onChange={(e) => setTemplateKey(e.target.value)}
                                    disabled={templates.length === 0}
                                >
                                    {templates.length === 0 ? (
                                        <option value="">Ê≤°ÊúâÂèØÁî®ÁöÑÊ®°Êùø</option>
                                    ) : (
                                        templates.map(template => (
                                            <option key={template.template_key} value={template.template_key}>
                                                {template.template_key} - {template.template_name}
                                                {template.description && ` (${template.description})`}
                                            </option>
                                        ))
                                    )}
                                </select>
                            </div>
                            
                            <div className="space-y-2">
                                <label className="block text-sm font-medium text-gray-700">
                                    Ê®°ÊùøÂèòÈáèÔºàJSONÔºâ
                                </label>
                                <JsonEditor
                                    value={variables}
                                    onChange={setVariables}
                                    placeholder='{"username": "Âº†‰∏â", "date": "2024-01-01"}'
                                />
                                {templateKey && templatesData[templateKey]?.variables && Array.isArray(templatesData[templateKey].variables) && (
                                    <div className="text-sm text-gray-600">
                                        <Icon name="info-circle" className="mr-1" />
                                        ÈúÄË¶ÅÁöÑÂèòÈáè: {templatesData[templateKey].variables.join(', ')}
                                    </div>
                                )}
                            </div>
                        </>
                    )}
                    
                    <div className="input-group">
                        <label>ÂπÇÁ≠âÈîÆÔºàÂèØÈÄâÔºâ</label>
                        <input
                            type="text"
                            placeholder="Áî®‰∫éÈò≤Ê≠¢ÈáçÂ§çÂèëÈÄÅ"
                            value={idempotencyKey}
                            onChange={(e) => setIdempotencyKey(e.target.value)}
                        />
                    </div>
                    
                    <button
                        className="btn btn-primary w-full md:w-auto"
                        onClick={sendNotification}
                        disabled={loading || selectedChannels.length === 0}
                    >
                        {loading ? (
                            <>
                                <LoadingSpinner size="small" />
                                ÂèëÈÄÅ‰∏≠...
                            </>
                        ) : (
                            <>
                                <Icon name="paper-plane" />
                                ÂèëÈÄÅÈÄöÁü•
                            </>
                        )}
                    </button>
                </div>
            );
        }
        
        // User Config Tab Component
        function UserConfigTab({ baseUrl, showResponse, apiSecret, generateGetSignature, generateSignature, showToast }) {
            const [userId, setUserId] = useState('');
            const [configs, setConfigs] = useState([]);
            const [loading, setLoading] = useState(false);
            const [newConfig, setNewConfig] = useState({
                userId: '',
                channelType: 'webhook',
                configData: '{}'
            });
            
            const getUserConfigs = async () => {
                setLoading(true);
                try {
                    const url = baseUrl + '/api/user-configs' + (userId ? `?user_id=${userId}` : '');
                    const timestamp = Date.now().toString();
                    const signature = await generateGetSignature(timestamp, url, apiSecret);
                    
                    const response = await fetch(url, {
                        headers: {
                            'X-Timestamp': timestamp,
                            'X-Signature': signature
                        }
                    });
                    const data = await response.json();
                    showResponse(data, response.status);
                    
                    if (data.success && data.data) {
                        setConfigs(data.data);
                        showToast('ÈÖçÁΩÆÂä†ËΩΩÊàêÂäü', 'success');
                    }
                } catch (error) {
                    showResponse({ error: error.message }, 400);
                    showToast('Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•', 'error');
                } finally {
                    setLoading(false);
                }
            };
            
            const upsertUserConfig = async () => {
                try {
                    const configData = JSON.parse(newConfig.configData);
                    const requestBody = {
                        user_id: newConfig.userId,
                        channel_type: newConfig.channelType,
                        config_data: configData
                    };
                    
                    const timestamp = Date.now().toString();
                    const body = JSON.stringify(requestBody);
                    const signature = await generateSignature(timestamp, body, apiSecret);
                    
                    const response = await fetch(baseUrl + '/api/user-configs', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Timestamp': timestamp,
                            'X-Signature': signature
                        },
                        body: body
                    });
                    
                    const data = await response.json();
                    showResponse(data, response.status);
                    
                    if (response.ok) {
                        getUserConfigs();
                        showToast('ÈÖçÁΩÆ‰øùÂ≠òÊàêÂäü', 'success');
                    }
                } catch (error) {
                    showResponse({ error: error.message }, 400);
                    showToast('‰øùÂ≠òÈÖçÁΩÆÂ§±Ë¥•', 'error');
                }
            };
            
            const deleteUserConfig = async (userId, channelType) => {
                if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÈÖçÁΩÆÂêóÔºü')) return;
                
                try {
                    const timestamp = Date.now().toString();
                    const body = JSON.stringify({ user_id: userId, channel_type: channelType });
                    const signature = await generateSignature(timestamp, body, apiSecret);
                    
                    const response = await fetch(baseUrl + '/api/user-configs', {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Timestamp': timestamp,
                            'X-Signature': signature
                        },
                        body: body
                    });
                    
                    const data = await response.json();
                    showResponse(data, response.status);
                    
                    if (response.ok) {
                        getUserConfigs();
                        showToast('ÈÖçÁΩÆÂà†Èô§ÊàêÂäü', 'success');
                    }
                } catch (error) {
                    showResponse({ error: error.message }, 400);
                    showToast('Âà†Èô§ÈÖçÁΩÆÂ§±Ë¥•', 'error');
                }
            };
            
            const setConfigTemplate = (type) => {
                const templates = {
                    webhook: {
                        webhook_url: "https://webhook.site/your-webhook-url"
                    },
                    telegram: {
                        bot_token: "YOUR_BOT_TOKEN",
                        chat_id: "YOUR_CHAT_ID"
                    },
                    lark: {
                        webhook_url: "https://open.feishu.cn/open-apis/bot/v2/hook/xxx",
                        secret: "YOUR_SECRET_KEY"
                    },
                    slack: {
                        webhook_url: "https://hooks.slack.com/services/xxx/xxx/xxx"
                    }
                };
                
                setNewConfig(prev => ({
                    ...prev,
                    channelType: type,
                    configData: JSON.stringify(templates[type], null, 2)
                }));
            };
            
            return (
                <div className="space-y-8">
                    {/* Query Section */}
                    <div>
                        <h3 className="text-lg font-bold mb-4 flex items-center gap-2">
                            <Icon name="search" />
                            Êü•ËØ¢Áî®Êà∑ÈÖçÁΩÆ
                        </h3>
                        <div className="flex gap-4">
                            <div className="flex-1 input-group">
                                <label>Áî®Êà∑ IDÔºàÂèØÈÄâÔºâ</label>
                                <input
                                    type="text"
                                    placeholder="ÁïôÁ©∫Êü•ËØ¢ÊâÄÊúâ"
                                    value={userId}
                                    onChange={(e) => setUserId(e.target.value)}
                                />
                            </div>
                            <button
                                className="btn btn-primary self-end"
                                onClick={getUserConfigs}
                                disabled={loading}
                            >
                                {loading ? <LoadingSpinner size="small" /> : <Icon name="search" />}
                                Êü•ËØ¢ÈÖçÁΩÆ
                            </button>
                        </div>
                    </div>
                    
                    {/* Results Table */}
                    {configs.length > 0 && (
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead>
                                    <tr className="border-b">
                                        <th className="text-left py-3 px-4">Áî®Êà∑ ID</th>
                                        <th className="text-left py-3 px-4">Ê∏†ÈÅìÁ±ªÂûã</th>
                                        <th className="text-left py-3 px-4">ÈÖçÁΩÆÊï∞ÊçÆ</th>
                                        <th className="text-left py-3 px-4">Áä∂ÊÄÅ</th>
                                        <th className="text-left py-3 px-4">Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {configs.map((config, index) => (
                                        <tr key={index} className="border-b hover:bg-gray-50">
                                            <td className="py-3 px-4">{config.user_id}</td>
                                            <td className="py-3 px-4">
                                                <span className="badge badge-info">{config.channel_type}</span>
                                            </td>
                                            <td className="py-3 px-4">
                                                <pre className="text-xs bg-gray-100 p-2 rounded max-w-xs overflow-auto">
                                                    {JSON.stringify(config.config_data, null, 2)}
                                                </pre>
                                            </td>
                                            <td className="py-3 px-4">
                                                <span className={`badge ${config.is_active ? 'badge-success' : 'badge-error'}`}>
                                                    {config.is_active ? 'ÊøÄÊ¥ª' : 'Á¶ÅÁî®'}
                                                </span>
                                            </td>
                                            <td className="py-3 px-4">
                                                <button
                                                    className="btn btn-danger btn-sm"
                                                    onClick={() => deleteUserConfig(config.user_id, config.channel_type)}
                                                >
                                                    <Icon name="trash" />
                                                    Âà†Èô§
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                    
                    {/* Create/Update Section */}
                    <div>
                        <h3 className="text-lg font-bold mb-4 flex items-center gap-2">
                            <Icon name="plus-circle" />
                            ÂàõÂª∫/Êõ¥Êñ∞ÈÖçÁΩÆ
                        </h3>
                        <div className="grid md:grid-cols-2 gap-4 mb-4">
                            <div className="input-group">
                                <label>Áî®Êà∑ ID</label>
                                <input
                                    type="text"
                                    placeholder="test-user"
                                    value={newConfig.userId}
                                    onChange={(e) => setNewConfig(prev => ({ ...prev, userId: e.target.value }))}
                                />
                            </div>
                            <div className="input-group">
                                <label>Ê∏†ÈÅìÁ±ªÂûã</label>
                                <select
                                    value={newConfig.channelType}
                                    onChange={(e) => setNewConfig(prev => ({ ...prev, channelType: e.target.value }))}
                                >
                                    <option value="webhook">Webhook</option>
                                    <option value="telegram">Telegram</option>
                                    <option value="lark">Lark</option>
                                    <option value="slack">Slack</option>
                                </select>
                            </div>
                        </div>
                        
                        <div className="space-y-2">
                            <label className="block text-sm font-medium text-gray-700">
                                ÈÖçÁΩÆÊï∞ÊçÆÔºàJSONÔºâ
                            </label>
                            <JsonEditor
                                value={newConfig.configData}
                                onChange={(value) => setNewConfig(prev => ({ ...prev, configData: value }))}
                                placeholder='{"key": "value"}'
                                rows={8}
                            />
                            <div className="flex gap-2">
                                <button
                                    type="button"
                                    onClick={() => setConfigTemplate('webhook')}
                                    className="text-sm text-indigo-600 hover:text-indigo-700"
                                >
                                    Webhook Ê®°Êùø
                                </button>
                                <button
                                    type="button"
                                    onClick={() => setConfigTemplate('telegram')}
                                    className="text-sm text-indigo-600 hover:text-indigo-700"
                                >
                                    Telegram Ê®°Êùø
                                </button>
                                <button
                                    type="button"
                                    onClick={() => setConfigTemplate('lark')}
                                    className="text-sm text-indigo-600 hover:text-indigo-700"
                                >
                                    Lark Ê®°Êùø
                                </button>
                                <button
                                    type="button"
                                    onClick={() => setConfigTemplate('slack')}
                                    className="text-sm text-indigo-600 hover:text-indigo-700"
                                >
                                    Slack Ê®°Êùø
                                </button>
                            </div>
                        </div>
                        
                        <button
                            className="btn btn-primary mt-4"
                            onClick={upsertUserConfig}
                        >
                            <Icon name="save" />
                            ‰øùÂ≠òÈÖçÁΩÆ
                        </button>
                    </div>
                </div>
            );
        }
        
        // Templates Tab Component
        function TemplatesTab({ baseUrl, showResponse, apiSecret, generateGetSignature, generateSignature, showToast }) {
            const [templates, setTemplates] = useState([]);
            const [loading, setLoading] = useState(false);
            const [newTemplate, setNewTemplate] = useState({
                templateKey: '',
                templateName: '',
                description: '',
                variables: '',
                channels: []
            });
            
            const getTemplates = async () => {
                setLoading(true);
                try {
                    const url = baseUrl + '/api/templates';
                    const timestamp = Date.now().toString();
                    const signature = await generateGetSignature(timestamp, url, apiSecret);
                    
                    const response = await fetch(url, {
                        headers: {
                            'X-Timestamp': timestamp,
                            'X-Signature': signature
                        }
                    });
                    const data = await response.json();
                    showResponse(data, response.status);
                    
                    if (data.success && data.data) {
                        setTemplates(data.data);
                        showToast('Ê®°ÊùøÂä†ËΩΩÊàêÂäü', 'success');
                    }
                } catch (error) {
                    showResponse({ error: error.message }, 400);
                    showToast('Âä†ËΩΩÊ®°ÊùøÂ§±Ë¥•', 'error');
                } finally {
                    setLoading(false);
                }
            };
            
            const addTemplateChannel = () => {
                setNewTemplate(prev => ({
                    ...prev,
                    channels: [...prev.channels, {
                        channelType: 'webhook',
                        contentType: 'text',
                        subjectTemplate: '',
                        contentTemplate: ''
                    }]
                }));
            };
            
            const removeTemplateChannel = (index) => {
                setNewTemplate(prev => ({
                    ...prev,
                    channels: prev.channels.filter((_, i) => i !== index)
                }));
            };
            
            const updateTemplateChannel = (index, field, value) => {
                setNewTemplate(prev => ({
                    ...prev,
                    channels: prev.channels.map((ch, i) => 
                        i === index ? { ...ch, [field]: value } : ch
                    )
                }));
            };
            
            const upsertTemplate = async () => {
                try {
                    const variables = newTemplate.variables ? 
                        newTemplate.variables.split(',').map(v => v.trim()).filter(v => v) : [];
                    
                    const requestBody = {
                        template_key: newTemplate.templateKey,
                        template_name: newTemplate.templateName,
                        description: newTemplate.description || undefined,
                        variables: variables.length > 0 ? variables : undefined,
                        channels: newTemplate.channels.map(ch => ({
                            channel_type: ch.channelType,
                            content_type: ch.contentType,
                            subject_template: ch.subjectTemplate || undefined,
                            content_template: ch.contentTemplate
                        }))
                    };
                    
                    const timestamp = Date.now().toString();
                    const body = JSON.stringify(requestBody);
                    const signature = await generateSignature(timestamp, body, apiSecret);
                    
                    const response = await fetch(baseUrl + '/api/templates', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Timestamp': timestamp,
                            'X-Signature': signature
                        },
                        body: body
                    });
                    
                    const data = await response.json();
                    showResponse(data, response.status);
                    
                    if (response.ok) {
                        setNewTemplate({
                            templateKey: '',
                            templateName: '',
                            description: '',
                            variables: '',
                            channels: []
                        });
                        getTemplates();
                        showToast('Ê®°Êùø‰øùÂ≠òÊàêÂäü', 'success');
                    }
                } catch (error) {
                    showResponse({ error: error.message }, 400);
                    showToast('‰øùÂ≠òÊ®°ÊùøÂ§±Ë¥•', 'error');
                }
            };
            
            const deleteTemplate = async (templateKey) => {
                if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Ê®°ÊùøÂêóÔºü')) return;
                
                try {
                    const url = baseUrl + '/api/templates';
                    const timestamp = Date.now().toString();
                    const body = JSON.stringify({ template_key: templateKey });
                    const signature = await generateSignature(timestamp, body, apiSecret);
                    
                    const response = await fetch(url, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Timestamp': timestamp,
                            'X-Signature': signature
                        },
                        body: body
                    });
                    
                    const data = await response.json();
                    showResponse(data, response.status);
                    
                    if (response.ok) {
                        getTemplates();
                        showToast('Ê®°ÊùøÂà†Èô§ÊàêÂäü', 'success');
                    }
                } catch (error) {
                    showResponse({ error: error.message }, 400);
                    showToast('Âà†Èô§Ê®°ÊùøÂ§±Ë¥•', 'error');
                }
            };
            
            useEffect(() => {
                getTemplates();
            }, []);
            
            return (
                <div className="space-y-8">
                    {/* Templates List */}
                    <div>
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-lg font-bold flex items-center gap-2">
                                <Icon name="list" />
                                Ê®°ÊùøÂàóË°®
                            </h3>
                            <button
                                className="btn btn-primary"
                                onClick={getTemplates}
                                disabled={loading}
                            >
                                {loading ? <LoadingSpinner size="small" /> : <Icon name="sync" />}
                                Âà∑Êñ∞
                            </button>
                        </div>
                        
                        {templates.length > 0 ? (
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead>
                                        <tr className="border-b">
                                            <th className="text-left py-3 px-4">Ê®°Êùø Key</th>
                                            <th className="text-left py-3 px-4">Ê®°ÊùøÂêçÁß∞</th>
                                            <th className="text-left py-3 px-4">ÊèèËø∞</th>
                                            <th className="text-left py-3 px-4">ÂèòÈáè</th>
                                            <th className="text-left py-3 px-4">ÊîØÊåÅÊ∏†ÈÅì</th>
                                            <th className="text-left py-3 px-4">Êìç‰Ωú</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {templates.map(template => (
                                            <tr key={template.template_key} className="border-b hover:bg-gray-50">
                                                <td className="py-3 px-4 font-mono text-sm">{template.template_key}</td>
                                                <td className="py-3 px-4">{template.template_name}</td>
                                                <td className="py-3 px-4 text-gray-600">{template.description || '-'}</td>
                                                <td className="py-3 px-4">
                                                    {Array.isArray(template.variables) && template.variables.length > 0 ? (
                                                        <div className="flex flex-wrap gap-1">
                                                            {template.variables.map(v => (
                                                                <span key={v} className="badge badge-info text-xs">
                                                                    {v}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    ) : '-'}
                                                </td>
                                                <td className="py-3 px-4">
                                                    {Array.isArray(template.supported_channels) && template.supported_channels.length > 0 ? (
                                                        <div className="flex flex-wrap gap-1">
                                                            {template.supported_channels.map(ch => (
                                                                <span key={ch} className="badge badge-success text-xs">
                                                                    {ch}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    ) : '-'}
                                                </td>
                                                <td className="py-3 px-4">
                                                    <button
                                                        className="btn btn-danger btn-sm"
                                                        onClick={() => deleteTemplate(template.template_key)}
                                                    >
                                                        <Icon name="trash" />
                                                        Âà†Èô§
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="text-center py-8 text-gray-500">
                                <Icon name="inbox" className="text-4xl mb-2" />
                                <p>ÊöÇÊó†Ê®°Êùø</p>
                            </div>
                        )}
                    </div>
                    
                    {/* Create/Update Template */}
                    <div>
                        <h3 className="text-lg font-bold mb-4 flex items-center gap-2">
                            <Icon name="plus-circle" />
                            ÂàõÂª∫/Êõ¥Êñ∞Ê®°Êùø
                        </h3>
                        
                        <div className="grid md:grid-cols-2 gap-4 mb-4">
                            <div className="input-group">
                                <label>Ê®°Êùø Key</label>
                                <input
                                    type="text"
                                    placeholder="welcome_email"
                                    value={newTemplate.templateKey}
                                    onChange={(e) => setNewTemplate(prev => ({ ...prev, templateKey: e.target.value }))}
                                />
                            </div>
                            <div className="input-group">
                                <label>Ê®°ÊùøÂêçÁß∞</label>
                                <input
                                    type="text"
                                    placeholder="Ê¨¢ËøéÈÇÆ‰ª∂"
                                    value={newTemplate.templateName}
                                    onChange={(e) => setNewTemplate(prev => ({ ...prev, templateName: e.target.value }))}
                                />
                            </div>
                        </div>
                        
                        <div className="grid md:grid-cols-2 gap-4 mb-4">
                            <div className="input-group">
                                <label>ÊèèËø∞ÔºàÂèØÈÄâÔºâ</label>
                                <input
                                    type="text"
                                    placeholder="Êñ∞Áî®Êà∑Ê≥®ÂÜåÊ¨¢ËøéÈÇÆ‰ª∂Ê®°Êùø"
                                    value={newTemplate.description}
                                    onChange={(e) => setNewTemplate(prev => ({ ...prev, description: e.target.value }))}
                                />
                            </div>
                            <div className="input-group">
                                <label>Ê®°ÊùøÂèòÈáèÔºàÈÄóÂè∑ÂàÜÈöîÔºâ</label>
                                <input
                                    type="text"
                                    placeholder="username, email, date"
                                    value={newTemplate.variables}
                                    onChange={(e) => setNewTemplate(prev => ({ ...prev, variables: e.target.value }))}
                                />
                            </div>
                        </div>
                        
                        <div className="mb-4">
                            <div className="flex items-center justify-between mb-2">
                                <label className="text-sm font-medium text-gray-700">Ê∏†ÈÅìÈÖçÁΩÆ</label>
                                <button
                                    type="button"
                                    onClick={addTemplateChannel}
                                    className="btn btn-secondary btn-sm"
                                >
                                    <Icon name="plus" />
                                    Ê∑ªÂä†Ê∏†ÈÅì
                                </button>
                            </div>
                            
                            <div className="space-y-4">
                                {newTemplate.channels.map((channel, index) => (
                                    <div key={index} className="card p-4 bg-gray-50">
                                        <div className="flex items-center justify-between mb-4">
                                            <h4 className="font-medium">Ê∏†ÈÅì #{index + 1}</h4>
                                            <button
                                                type="button"
                                                onClick={() => removeTemplateChannel(index)}
                                                className="text-red-600 hover:text-red-700"
                                            >
                                                <Icon name="times" />
                                            </button>
                                        </div>
                                        
                                        <div className="grid md:grid-cols-2 gap-4 mb-4">
                                            <div className="input-group">
                                                <label>Ê∏†ÈÅìÁ±ªÂûã</label>
                                                <select
                                                    value={channel.channelType}
                                                    onChange={(e) => updateTemplateChannel(index, 'channelType', e.target.value)}
                                                >
                                                    <option value="webhook">Webhook</option>
                                                    <option value="telegram">Telegram</option>
                                                    <option value="lark">Lark</option>
                                                    <option value="slack">Slack</option>
                                                    <option value="email">Email</option>
                                                </select>
                                            </div>
                                            <div className="input-group">
                                                <label>ÂÜÖÂÆπÁ±ªÂûã</label>
                                                <select
                                                    value={channel.contentType}
                                                    onChange={(e) => updateTemplateChannel(index, 'contentType', e.target.value)}
                                                >
                                                    <option value="text">Text</option>
                                                    <option value="html">HTML</option>
                                                    <option value="markdown">Markdown</option>
                                                    <option value="json">JSON</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div className="input-group">
                                            <label>‰∏ªÈ¢òÊ®°ÊùøÔºàEmail Ê∏†ÈÅìÂèØÁî®Ôºâ</label>
                                            <input
                                                type="text"
                                                placeholder="Welcome {{username}}!"
                                                value={channel.subjectTemplate}
                                                onChange={(e) => updateTemplateChannel(index, 'subjectTemplate', e.target.value)}
                                            />
                                        </div>
                                        
                                        <div className="input-group">
                                            <label>ÂÜÖÂÆπÊ®°Êùø *</label>
                                            <textarea
                                                placeholder="‰ΩøÁî® {{ÂèòÈáèÂêç}} ‰Ωú‰∏∫Âç†‰ΩçÁ¨¶"
                                                required
                                                rows="4"
                                                value={channel.contentTemplate}
                                                onChange={(e) => updateTemplateChannel(index, 'contentTemplate', e.target.value)}
                                            />
                                        </div>
                                    </div>
                                ))}
                                
                                {newTemplate.channels.length === 0 && (
                                    <div className="text-center py-8 text-gray-500 bg-gray-50 rounded-lg">
                                        <Icon name="info-circle" className="text-2xl mb-2" />
                                        <p>ËØ∑Ê∑ªÂä†Ëá≥Â∞ë‰∏Ä‰∏™Ê∏†ÈÅìÈÖçÁΩÆ</p>
                                    </div>
                                )}
                            </div>
                        </div>
                        
                        <button
                            className="btn btn-primary"
                            onClick={upsertTemplate}
                            disabled={!newTemplate.templateKey || !newTemplate.templateName || newTemplate.channels.length === 0}
                        >
                            <Icon name="save" />
                            ‰øùÂ≠òÊ®°Êùø
                        </button>
                    </div>
                </div>
            );
        }
        
        // Logs Tab Component
        function LogsTab({ baseUrl, showResponse, apiSecret, generateGetSignature, generateSignature, showToast }) {
            const [filters, setFilters] = useState({
                userId: '',
                status: '',
                limit: '20',
                offset: '0'
            });
            const [cleanupDays, setCleanupDays] = useState('7');
            const [loading, setLoading] = useState(false);
            
            const getNotificationLogs = async () => {
                setLoading(true);
                try {
                    const params = new URLSearchParams();
                    if (filters.userId) params.append('user_id', filters.userId);
                    if (filters.status) params.append('status', filters.status);
                    params.append('limit', filters.limit);
                    params.append('offset', filters.offset);
                    
                    const url = baseUrl + '/api/notification-logs?' + params;
                    const timestamp = Date.now().toString();
                    const signature = await generateGetSignature(timestamp, url, apiSecret);
                    
                    const response = await fetch(url, {
                        headers: {
                            'X-Timestamp': timestamp,
                            'X-Signature': signature
                        }
                    });
                    const data = await response.json();
                    showResponse(data, response.status);
                    
                    if (response.ok) {
                        showToast('Êó•ÂøóÊü•ËØ¢ÊàêÂäü', 'success');
                    }
                } catch (error) {
                    showResponse({ error: error.message }, 400);
                    showToast('Êü•ËØ¢Êó•ÂøóÂ§±Ë¥•', 'error');
                } finally {
                    setLoading(false);
                }
            };
            
            const cleanupLogs = async () => {
                if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ ${cleanupDays} Â§©ÂâçÁöÑÊó•ÂøóÂêóÔºü`)) return;
                
                try {
                    const timestamp = Date.now().toString();
                    const body = JSON.stringify({ days: parseInt(cleanupDays) });
                    const signature = await generateSignature(timestamp, body, apiSecret);
                    
                    const response = await fetch(baseUrl + '/api/notification-logs/cleanup', {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Timestamp': timestamp,
                            'X-Signature': signature
                        },
                        body: body
                    });
                    
                    const data = await response.json();
                    showResponse(data, response.status);
                    
                    if (response.ok) {
                        showToast('Êó•ÂøóÊ∏ÖÁêÜÊàêÂäü', 'success');
                    }
                } catch (error) {
                    showResponse({ error: error.message }, 400);
                    showToast('Ê∏ÖÁêÜÊó•ÂøóÂ§±Ë¥•', 'error');
                }
            };
            
            const triggerRetry = async () => {
                if (!confirm('Á°ÆÂÆöË¶ÅÁ´ãÂç≥Ëß¶ÂèëÈáçËØïÂêóÔºü')) return;
                
                try {
                    const timestamp = Date.now().toString();
                    const body = JSON.stringify({});
                    const signature = await generateSignature(timestamp, body, apiSecret);
                    
                    const response = await fetch(baseUrl + '/api/notifications/retry', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Timestamp': timestamp,
                            'X-Signature': signature
                        },
                        body: body
                    });
                    
                    const data = await response.json();
                    showResponse(data, response.status);
                    
                    if (response.ok) {
                        showToast('ÈáçËØïËß¶ÂèëÊàêÂäü', 'success');
                    }
                } catch (error) {
                    showResponse({ error: error.message }, 400);
                    showToast('Ëß¶ÂèëÈáçËØïÂ§±Ë¥•', 'error');
                }
            };
            
            return (
                <div className="space-y-8">
                    {/* Query Section */}
                    <div>
                        <h3 className="text-lg font-bold mb-4 flex items-center gap-2">
                            <Icon name="search" />
                            Êü•ËØ¢ÈÄöÁü•Êó•Âøó
                        </h3>
                        
                        <div className="grid md:grid-cols-2 gap-4 mb-4">
                            <div className="input-group">
                                <label>Áî®Êà∑ IDÔºàÂèØÈÄâÔºâ</label>
                                <input
                                    type="text"
                                    placeholder="ÁïôÁ©∫Êü•ËØ¢ÊâÄÊúâ"
                                    value={filters.userId}
                                    onChange={(e) => setFilters(prev => ({ ...prev, userId: e.target.value }))}
                                />
                            </div>
                            <div className="input-group">
                                <label>Áä∂ÊÄÅÔºàÂèØÈÄâÔºâ</label>
                                <select
                                    value={filters.status}
                                    onChange={(e) => setFilters(prev => ({ ...prev, status: e.target.value }))}
                                >
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="pending">ÂæÖÂèëÈÄÅ</option>
                                    <option value="sent">ÊàêÂäü</option>
                                    <option value="failed">Â§±Ë¥•</option>
                                    <option value="retry">ÈáçËØï‰∏≠</option>
                                </select>
                            </div>
                        </div>
                        
                        <div className="grid md:grid-cols-2 gap-4 mb-4">
                            <div className="input-group">
                                <label>ÊØèÈ°µÊï∞Èáè</label>
                                <input
                                    type="number"
                                    min="1"
                                    max="100"
                                    value={filters.limit}
                                    onChange={(e) => setFilters(prev => ({ ...prev, limit: e.target.value }))}
                                />
                            </div>
                            <div className="input-group">
                                <label>ÂÅèÁßªÈáè</label>
                                <input
                                    type="number"
                                    min="0"
                                    value={filters.offset}
                                    onChange={(e) => setFilters(prev => ({ ...prev, offset: e.target.value }))}
                                />
                            </div>
                        </div>
                        
                        <button
                            className="btn btn-primary"
                            onClick={getNotificationLogs}
                            disabled={loading}
                        >
                            {loading ? <LoadingSpinner size="small" /> : <Icon name="search" />}
                            Êü•ËØ¢Êó•Âøó
                        </button>
                    </div>
                    
                    {/* Management Section */}
                    <div>
                        <h3 className="text-lg font-bold mb-4 flex items-center gap-2">
                            <Icon name="cog" />
                            Êó•ÂøóÁÆ°ÁêÜ
                        </h3>
                        
                        <div className="grid md:grid-cols-2 gap-6">
                            <div className="card p-6 bg-gray-50">
                                <h4 className="font-medium mb-4 flex items-center gap-2">
                                    <Icon name="trash" className="text-red-600" />
                                    Ê∏ÖÁêÜÊó•Âøó
                                </h4>
                                <p className="text-sm text-gray-600 mb-4">
                                    Âà†Èô§ÊåáÂÆöÂ§©Êï∞‰πãÂâçÁöÑÊó•ÂøóËÆ∞ÂΩï
                                </p>
                                <div className="flex gap-2">
                                    <input
                                        type="number"
                                        min="1"
                                        className="flex-1 px-4 py-2 border-2 border-gray-300 rounded-lg"
                                        placeholder="Â§©Êï∞"
                                        value={cleanupDays}
                                        onChange={(e) => setCleanupDays(e.target.value)}
                                    />
                                    <button
                                        className="btn btn-danger"
                                        onClick={cleanupLogs}
                                    >
                                        <Icon name="trash" />
                                        Ê∏ÖÁêÜÊó•Âøó
                                    </button>
                                </div>
                            </div>
                            
                            <div className="card p-6 bg-gray-50">
                                <h4 className="font-medium mb-4 flex items-center gap-2">
                                    <Icon name="redo" className="text-blue-600" />
                                    Ëß¶ÂèëÈáçËØï
                                </h4>
                                <p className="text-sm text-gray-600 mb-4">
                                    Á´ãÂç≥Ëß¶ÂèëÂ§±Ë¥•ÈÄöÁü•ÁöÑÈáçËØïÔºàÈÄöÂ∏∏Áî±ÂÆöÊó∂‰ªªÂä°Ëá™Âä®ÊâßË°åÔºâ
                                </p>
                                <button
                                    className="btn btn-primary"
                                    onClick={triggerRetry}
                                >
                                    <Icon name="redo" />
                                    Á´ãÂç≥ÈáçËØï
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        // Health Tab Component
        function HealthTab({ baseUrl, showResponse, showToast }) {
            const [healthStatus, setHealthStatus] = useState(null);
            const [loading, setLoading] = useState(false);
            const [scheduledTasksStatus, setScheduledTasksStatus] = useState(null);
            
            const testHealth = async () => {
                setLoading(true);
                try {
                    const response = await fetch(baseUrl + '/health');
                    const data = await response.json();
                    showResponse(data, response.status);
                    setHealthStatus(data);
                    
                    if (data.status === 'healthy') {
                        showToast('Á≥ªÁªüËøêË°åÊ≠£Â∏∏', 'success');
                    } else {
                        showToast('Á≥ªÁªüÂ≠òÂú®ÂºÇÂ∏∏', 'error');
                    }
                } catch (error) {
                    showResponse({ error: error.message }, 400);
                    showToast('ÂÅ•Â∫∑Ê£ÄÊü•Â§±Ë¥•', 'error');
                } finally {
                    setLoading(false);
                }
            };
            
            const checkScheduledTasksHealth = async () => {
                try {
                    const response = await fetch(baseUrl + '/health/scheduled-tasks');
                    const data = await response.json();
                    showResponse(data, response.status);
                    setScheduledTasksStatus(data);
                    showToast('ÂÆöÊó∂‰ªªÂä°Áä∂ÊÄÅËé∑ÂèñÊàêÂäü', 'success');
                } catch (error) {
                    showResponse({ error: error.message }, 400);
                    showToast('Ëé∑ÂèñÂÆöÊó∂‰ªªÂä°Áä∂ÊÄÅÂ§±Ë¥•', 'error');
                }
            };
            
            useEffect(() => {
                testHealth();
            }, []);
            
            return (
                <div className="space-y-8">
                    {/* System Health */}
                    <div>
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-lg font-bold flex items-center gap-2">
                                <Icon name="heartbeat" />
                                Á≥ªÁªüÂÅ•Â∫∑Áä∂ÊÄÅ
                            </h3>
                            <button
                                className="btn btn-primary"
                                onClick={testHealth}
                                disabled={loading}
                            >
                                {loading ? <LoadingSpinner size="small" /> : <Icon name="sync" />}
                                Ê£ÄÊü•ÂÅ•Â∫∑Áä∂ÊÄÅ
                            </button>
                        </div>
                        
                        {healthStatus && (
                            <div className="grid md:grid-cols-2 gap-6">
                                <div className="card p-6">
                                    <h4 className="font-medium mb-4 flex items-center gap-2">
                                        Á≥ªÁªüÁä∂ÊÄÅ
                                        <span className={`badge ${healthStatus.status === 'healthy' ? 'badge-success' : 'badge-error'}`}>
                                            {healthStatus.status === 'healthy' ? 'ÂÅ•Â∫∑' : 'ÂºÇÂ∏∏'}
                                        </span>
                                    </h4>
                                    <dl className="space-y-2">
                                        <div className="flex justify-between">
                                            <dt className="text-gray-600">ÁéØÂ¢É</dt>
                                            <dd className="font-medium">{healthStatus.environment || 'production'}</dd>
                                        </div>
                                        <div className="flex justify-between">
                                            <dt className="text-gray-600">Ê£ÄÊü•Êó∂Èó¥</dt>
                                            <dd className="font-medium">
                                                {new Date(healthStatus.timestamp).toLocaleString('zh-CN')}
                                            </dd>
                                        </div>
                                        {healthStatus.version && (
                                            <div className="flex justify-between">
                                                <dt className="text-gray-600">ÁâàÊú¨</dt>
                                                <dd className="font-medium">{healthStatus.version}</dd>
                                            </div>
                                        )}
                                    </dl>
                                </div>
                                
                                {healthStatus.services && (
                                    <div className="card p-6">
                                        <h4 className="font-medium mb-4">ÊúçÂä°Áä∂ÊÄÅ</h4>
                                        <div className="space-y-2">
                                            {Object.entries(healthStatus.services).map(([service, status]) => (
                                                <div key={service} className="flex items-center justify-between">
                                                    <span className="capitalize">{service}</span>
                                                    <span className={`badge ${status ? 'badge-success' : 'badge-error'}`}>
                                                        {status ? 'Ê≠£Â∏∏' : 'ÂºÇÂ∏∏'}
                                                    </span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                    
                    {/* Scheduled Tasks */}
                    <div>
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-lg font-bold flex items-center gap-2">
                                <Icon name="clock" />
                                ÂÆöÊó∂‰ªªÂä°ÂÅ•Â∫∑Áä∂ÊÄÅ
                            </h3>
                            <button
                                className="btn btn-primary"
                                onClick={checkScheduledTasksHealth}
                            >
                                <Icon name="sync" />
                                Ê£ÄÊü•ÂÆöÊó∂‰ªªÂä°
                            </button>
                        </div>
                        
                        {scheduledTasksStatus && scheduledTasksStatus.tasks && (
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead>
                                        <tr className="border-b">
                                            <th className="text-left py-3 px-4">‰ªªÂä°ÂêçÁß∞</th>
                                            <th className="text-left py-3 px-4">ÊúÄÂêéËøêË°å</th>
                                            <th className="text-left py-3 px-4">‰∏ãÊ¨°ËøêË°å</th>
                                            <th className="text-left py-3 px-4">Áä∂ÊÄÅ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {Object.entries(scheduledTasksStatus.tasks).map(([taskName, taskInfo]) => (
                                            <tr key={taskName} className="border-b hover:bg-gray-50">
                                                <td className="py-3 px-4 font-medium">
                                                    {taskName.replace(/_/g, ' ').toUpperCase()}
                                                </td>
                                                <td className="py-3 px-4">
                                                    {taskInfo.lastRun ? 
                                                        new Date(taskInfo.lastRun).toLocaleString('zh-CN') : 
                                                        'Êú™ËøêË°å'
                                                    }
                                                </td>
                                                <td className="py-3 px-4">
                                                    {taskInfo.nextRun ? 
                                                        new Date(taskInfo.nextRun).toLocaleString('zh-CN') : 
                                                        '-'
                                                    }
                                                </td>
                                                <td className="py-3 px-4">
                                                    <span className={`badge ${taskInfo.isRunning ? 'badge-warning' : 'badge-success'}`}>
                                                        {taskInfo.isRunning ? 'ËøêË°å‰∏≠' : 'Á©∫Èó≤'}
                                                    </span>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        
        // Metrics Tab Component
        function MetricsTab({ baseUrl, showResponse, apiSecret, generateGetSignature, showToast }) {
            const getMetrics = async () => {
                try {
                    const url = baseUrl + '/metrics';
                    const timestamp = Date.now().toString();
                    const signature = await generateGetSignature(timestamp, url, apiSecret);
                    
                    const response = await fetch(url, {
                        headers: {
                            'X-Timestamp': timestamp,
                            'X-Signature': signature
                        }
                    });
                    const data = await response.json();
                    showResponse(data, response.status);
                    
                    if (response.ok) {
                        showToast('ÊåáÊ†áËé∑ÂèñÊàêÂäü', 'success');
                    }
                } catch (error) {
                    showResponse({ error: error.message }, 400);
                    showToast('Ëé∑ÂèñÊåáÊ†áÂ§±Ë¥•', 'error');
                }
            };
            
            return (
                <div className="space-y-6">
                    <div className="flex items-center justify-between mb-4">
                        <h3 className="text-lg font-bold flex items-center gap-2">
                            <Icon name="chart-line" />
                            Á≥ªÁªüÊåáÊ†á
                        </h3>
                        <button
                            className="btn btn-primary"
                            onClick={getMetrics}
                        >
                            <Icon name="sync" />
                            Ëé∑ÂèñÁ≥ªÁªüÊåáÊ†á
                        </button>
                    </div>
                    
                    <div className="card p-6 bg-gradient-to-r from-indigo-50 to-purple-50">
                        <h4 className="font-medium mb-4">Á≥ªÁªüÊåáÊ†áÂåÖÊã¨</h4>
                        <div className="grid md:grid-cols-2 gap-4">
                            <div className="flex items-start gap-3">
                                <Icon name="chart-bar" className="text-indigo-600 mt-1" />
                                <div>
                                    <h5 className="font-medium">ÈÄöÁü•ÁªüËÆ°</h5>
                                    <p className="text-sm text-gray-600">ÊÄªÈÄöÁü•Êï∞Èáè„ÄÅÊàêÂäü/Â§±Ë¥•ÁªüËÆ°</p>
                                </div>
                            </div>
                            <div className="flex items-start gap-3">
                                <Icon name="share-alt" className="text-purple-600 mt-1" />
                                <div>
                                    <h5 className="font-medium">Ê∏†ÈÅì‰ΩøÁî®</h5>
                                    <p className="text-sm text-gray-600">ÂêÑÊ∏†ÈÅì‰ΩøÁî®ÊÉÖÂÜµÁªüËÆ°</p>
                                </div>
                            </div>
                            <div className="flex items-start gap-3">
                                <Icon name="file-alt" className="text-blue-600 mt-1" />
                                <div>
                                    <h5 className="font-medium">Ê®°Êùø‰ΩøÁî®</h5>
                                    <p className="text-sm text-gray-600">Ê®°Êùø‰ΩøÁî®È¢ëÁéáÂíåÊïàÊûú</p>
                                </div>
                            </div>
                            <div className="flex items-start gap-3">
                                <Icon name="tachometer-alt" className="text-green-600 mt-1" />
                                <div>
                                    <h5 className="font-medium">ÊÄßËÉΩÊåáÊ†á</h5>
                                    <p className="text-sm text-gray-600">ÂìçÂ∫îÊó∂Èó¥ÂíåÁ≥ªÁªüËµÑÊ∫ê‰ΩøÁî®</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        // Grafana Tab Component
        function GrafanaTab({ baseUrl, showResponse, environment, showToast }) {
            const [grafanaAuth, setGrafanaAuth] = useState(() => {
                const envPrefix = environment === 'production' ? 'prod_' : 'local_';
                return {
                    username: localStorage.getItem(`${envPrefix}grafana_username`) || 'grafana',
                    password: localStorage.getItem(`${envPrefix}grafana_password`) || 'test-password'
                };
            });
            
            const [grafanaPayload, setGrafanaPayload] = useState({
                receiver: 'test-user',
                channels: 'webhook',
                alertStatus: 'firing',
                useTemplate: false,
                templateKey: 'grafana-alert',
                customAlert: JSON.stringify({
                    status: 'firing',
                    labels: {
                        alertname: 'High CPU Usage',
                        severity: 'critical',
                        instance: 'server-01'
                    },
                    annotations: {
                        description: 'CPU usage is above 90%',
                        summary: 'High CPU usage detected'
                    },
                    startsAt: new Date(Date.now() - 10 * 60 * 1000).toISOString(),
                    endsAt: '0001-01-01T00:00:00Z',
                    generatorURL: 'http://grafana.example.com/alert',
                    fingerprint: '123456789'
                }, null, 2)
            });
            
            const [loading, setLoading] = useState(false);
            
            // Save auth to localStorage when changed
            const updateAuth = (field, value) => {
                const newAuth = { ...grafanaAuth, [field]: value };
                setGrafanaAuth(newAuth);
                const envPrefix = environment === 'production' ? 'prod_' : 'local_';
                localStorage.setItem(`${envPrefix}grafana_${field}`, value);
            };
            
            // Generate Grafana webhook payload
            const generatePayload = () => {
                const basePayload = {
                    receiver: grafanaPayload.receiver,
                    status: grafanaPayload.alertStatus,
                    alerts: [],
                    groupLabels: {},
                    commonLabels: {},
                    commonAnnotations: {},
                    externalURL: 'http://alertmanager.example.com',
                    version: '4',
                    groupKey: '{}:{}'
                };
                
                try {
                    const customAlert = JSON.parse(grafanaPayload.customAlert);
                    customAlert.status = grafanaPayload.alertStatus;
                    
                    if (grafanaPayload.alertStatus === 'resolved' && customAlert.endsAt === '0001-01-01T00:00:00Z') {
                        customAlert.endsAt = new Date().toISOString();
                    }
                    
                    basePayload.alerts = [customAlert];
                    basePayload.groupLabels = { alertname: customAlert.labels.alertname };
                    basePayload.commonLabels = customAlert.labels;
                    basePayload.commonAnnotations = customAlert.annotations;
                    
                    // Add template key to labels if using template
                    if (grafanaPayload.useTemplate) {
                        basePayload.commonLabels.notification_template = grafanaPayload.templateKey;
                    }
                    
                    return basePayload;
                } catch (error) {
                    console.error('Invalid alert JSON:', error);
                    return basePayload;
                }
            };
            
            // Send Grafana webhook
            const sendGrafanaWebhook = async () => {
                setLoading(true);
                try {
                    const payload = generatePayload();
                    const authString = btoa(`${grafanaAuth.username}:${grafanaAuth.password}`);
                    
                    const response = await fetch(baseUrl + '/api/webhooks/grafana', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Basic ${authString}`,
                            'X-Notification-Channels': grafanaPayload.channels
                        },
                        body: JSON.stringify(payload)
                    });
                    
                    const data = await response.json();
                    showResponse(data, response.status);
                    
                    if (response.ok) {
                        showToast('Grafana webhook ÂèëÈÄÅÊàêÂäü', 'success');
                    } else {
                        showToast('Grafana webhook ÂèëÈÄÅÂ§±Ë¥•', 'error');
                    }
                } catch (error) {
                    showResponse({ error: error.message }, 400);
                    showToast('ÂèëÈÄÅÂ§±Ë¥•', 'error');
                } finally {
                    setLoading(false);
                }
            };
            
            // Preset templates
            const presetAlerts = {
                cpu: {
                    name: 'CPU ‰ΩøÁî®Áéá',
                    icon: 'microchip',
                    color: 'text-red-600',
                    labels: {
                        alertname: 'High CPU Usage',
                        severity: 'critical',
                        instance: 'server-01',
                        job: 'node-exporter'
                    },
                    annotations: {
                        description: 'CPU usage on server-01 has been above 90% for more than 5 minutes',
                        summary: 'High CPU usage detected on production server'
                    }
                },
                memory: {
                    name: 'ÂÜÖÂ≠ò‰ΩøÁî®',
                    icon: 'memory',
                    color: 'text-orange-600',
                    labels: {
                        alertname: 'High Memory Usage',
                        severity: 'warning',
                        instance: 'server-02',
                        job: 'node-exporter'
                    },
                    annotations: {
                        description: 'Memory usage is above 85%',
                        summary: 'High memory usage detected'
                    }
                },
                disk: {
                    name: 'Á£ÅÁõòÁ©∫Èó¥',
                    icon: 'hdd',
                    color: 'text-yellow-600',
                    labels: {
                        alertname: 'Disk Space Low',
                        severity: 'warning',
                        instance: 'server-03',
                        job: 'node-exporter',
                        mountpoint: '/var/lib'
                    },
                    annotations: {
                        description: 'Disk space on /var/lib is below 10%',
                        summary: 'Low disk space warning'
                    }
                },
                api: {
                    name: 'API Âª∂Ëøü',
                    icon: 'network-wired',
                    color: 'text-purple-600',
                    labels: {
                        alertname: 'API Response Time High',
                        severity: 'critical',
                        service: 'api-gateway',
                        endpoint: '/api/v1/users'
                    },
                    annotations: {
                        description: 'API response time is above 1000ms',
                        summary: 'High API latency detected'
                    }
                }
            };
            
            const applyPreset = (presetKey) => {
                const preset = presetAlerts[presetKey];
                const currentAlert = JSON.parse(grafanaPayload.customAlert);
                
                setGrafanaPayload(prev => ({
                    ...prev,
                    customAlert: JSON.stringify({
                        ...currentAlert,
                        labels: preset.labels,
                        annotations: preset.annotations
                    }, null, 2)
                }));
                
                showToast(`Â∑≤Â∫îÁî® ${preset.name} Ê®°Êùø`, 'success');
            };
            
            return (
                <div className="space-y-6">
                    <div className="card p-6 bg-gradient-to-r from-blue-50 to-indigo-50">
                        <h3 className="text-lg font-bold mb-4 flex items-center gap-2">
                            <Icon name="chart-area" />
                            Grafana Alerting ÈõÜÊàê
                        </h3>
                        <p className="text-gray-600">
                            Ê≠§Á´ØÁÇπÊé•Êî∂ Grafana Alerting ÁöÑ webhook ÈÄöÁü•ÔºåÂπ∂ËΩ¨ÂèëÂà∞ÊåáÂÆöÁöÑÈÄöÁü•Ê∏†ÈÅì„ÄÇ
                            ‰ΩøÁî® receiver Â≠óÊÆµ‰Ωú‰∏∫Áî®Êà∑ IDÔºåÊîØÊåÅËá™ÂÆö‰πâÂëäË≠¶ÂÜÖÂÆπÂíåÊ®°Êùø„ÄÇ
                        </p>
                    </div>
                    
                    {/* Authentication */}
                    <div>
                        <h4 className="font-medium mb-4">ËÆ§ËØÅÈÖçÁΩÆ</h4>
                        <div className="grid md:grid-cols-2 gap-4">
                            <div className="input-group">
                                <label>Áî®Êà∑Âêç</label>
                                <input
                                    type="text"
                                    value={grafanaAuth.username}
                                    onChange={(e) => updateAuth('username', e.target.value)}
                                    placeholder="grafana"
                                />
                            </div>
                            <div className="input-group">
                                <label>ÂØÜÁ†Å</label>
                                <input
                                    type="password"
                                    value={grafanaAuth.password}
                                    onChange={(e) => updateAuth('password', e.target.value)}
                                    placeholder="test-password"
                                />
                            </div>
                        </div>
                    </div>
                    
                    {/* Webhook Configuration */}
                    <div>
                        <h4 className="font-medium mb-4">Webhook ÈÖçÁΩÆ</h4>
                        <div className="grid md:grid-cols-2 gap-4 mb-4">
                            <div className="input-group">
                                <label>Receiver (Áî®Êà∑ ID) *</label>
                                <input
                                    type="text"
                                    value={grafanaPayload.receiver}
                                    onChange={(e) => setGrafanaPayload(prev => ({ ...prev, receiver: e.target.value }))}
                                    placeholder="test-user"
                                />
                                <QuickFillButtons
                                    options={[
                                        { label: 'ÊµãËØïÁî®Êà∑', value: 'test-user' },
                                        { label: 'ËøêÁª¥Âõ¢Èòü', value: 'ops-team' },
                                        { label: 'ÂºÄÂèëÂõ¢Èòü', value: 'dev-team' }
                                    ]}
                                    onSelect={(value) => setGrafanaPayload(prev => ({ ...prev, receiver: value }))}
                                />
                            </div>
                            <div className="input-group">
                                <label>ÈÄöÁü•Ê∏†ÈÅì (X-Notification-Channels)</label>
                                <input
                                    type="text"
                                    value={grafanaPayload.channels}
                                    onChange={(e) => setGrafanaPayload(prev => ({ ...prev, channels: e.target.value }))}
                                    placeholder="webhook,telegram,lark"
                                />
                                <QuickFillButtons
                                    options={[
                                        { label: 'Webhook', value: 'webhook' },
                                        { label: 'Webhook + Telegram', value: 'webhook,telegram' },
                                        { label: 'Â§öÊ∏†ÈÅì', value: 'webhook,lark,slack' }
                                    ]}
                                    onSelect={(value) => setGrafanaPayload(prev => ({ ...prev, channels: value }))}
                                />
                            </div>
                        </div>
                        
                        <div className="grid md:grid-cols-2 gap-4 mb-4">
                            <div className="input-group">
                                <label>ÂëäË≠¶Áä∂ÊÄÅ</label>
                                <select
                                    value={grafanaPayload.alertStatus}
                                    onChange={(e) => setGrafanaPayload(prev => ({ ...prev, alertStatus: e.target.value }))}
                                >
                                    <option value="firing">üî• Firing (Ëß¶Âèë)</option>
                                    <option value="resolved">‚úÖ Resolved (ÊÅ¢Â§ç)</option>
                                </select>
                            </div>
                            <div className="flex items-center gap-4">
                                <label className="flex items-center gap-2 cursor-pointer">
                                    <input
                                        type="checkbox"
                                        checked={grafanaPayload.useTemplate}
                                        onChange={(e) => setGrafanaPayload(prev => ({ ...prev, useTemplate: e.target.checked }))}
                                        className="w-4 h-4"
                                    />
                                    <span>‰ΩøÁî®Ê®°Êùø</span>
                                </label>
                                {grafanaPayload.useTemplate && (
                                    <select
                                        className="flex-1 px-4 py-2 border-2 border-gray-300 rounded-lg"
                                        value={grafanaPayload.templateKey}
                                        onChange={(e) => setGrafanaPayload(prev => ({ ...prev, templateKey: e.target.value }))}
                                    >
                                        <option value="grafana-alert">grafana-alert (ÈªòËÆ§)</option>
                                        <option value="grafana-alert-critical">grafana-alert-critical (‰∏•Èáç)</option>
                                        <option value="custom">Ëá™ÂÆö‰πâÊ®°Êùø Key</option>
                                    </select>
                                )}
                            </div>
                        </div>
                    </div>
                    
                    {/* Alert Content */}
                    <div>
                        <div className="flex items-center justify-between mb-2">
                            <label className="text-sm font-medium text-gray-700">
                                ÂëäË≠¶ÂÜÖÂÆπ (JSON)
                            </label>
                            <div className="flex gap-2">
                                {Object.entries(presetAlerts).map(([key, preset]) => (
                                    <button
                                        key={key}
                                        onClick={() => applyPreset(key)}
                                        className="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded-full transition-colors flex items-center gap-1"
                                    >
                                        <Icon name={preset.icon} className={preset.color} />
                                        {preset.name}
                                    </button>
                                ))}
                            </div>
                        </div>
                        <JsonEditor
                            value={grafanaPayload.customAlert}
                            onChange={(value) => setGrafanaPayload(prev => ({ ...prev, customAlert: value }))}
                            placeholder="ËæìÂÖ• Grafana ÂëäË≠¶ JSON"
                            rows={15}
                        />
                    </div>
                    
                    <button
                        className="btn btn-primary w-full md:w-auto"
                        onClick={sendGrafanaWebhook}
                        disabled={loading || !grafanaPayload.receiver}
                    >
                        {loading ? (
                            <>
                                <LoadingSpinner size="small" />
                                ÂèëÈÄÅ‰∏≠...
                            </>
                        ) : (
                            <>
                                <Icon name="paper-plane" />
                                ÂèëÈÄÅ Grafana Webhook
                            </>
                        )}
                    </button>
                    
                    {/* Usage Instructions */}
                    <div className="card p-6 bg-gray-50">
                        <h4 className="font-medium mb-4 flex items-center gap-2">
                            <Icon name="book" />
                            ‰ΩøÁî®ËØ¥Êòé
                        </h4>
                        
                        <div className="space-y-4">
                            <div>
                                <h5 className="font-medium mb-2">Grafana Contact Point ÈÖçÁΩÆÁ§∫‰æã</h5>
                                <pre className="bg-white p-4 rounded-lg text-sm overflow-auto">
{`name: Notification System
type: webhook
settings:
  url: ${baseUrl}/api/webhooks/grafana
  httpMethod: POST
  username: ${grafanaAuth.username}
  password: <YOUR_PASSWORD>
  
  # Ëá™ÂÆö‰πâËØ∑Ê±ÇÂ§¥
  httpHeaderName1: X-Notification-Channels
  httpHeaderValue1: webhook,telegram,lark`}
                                </pre>
                            </div>
                            
                            <div>
                                <h5 className="font-medium mb-2">Alert Rule ÈÖçÁΩÆ</h5>
                                <pre className="bg-white p-4 rounded-lg text-sm overflow-auto">
{`# Âú® Alert Rule ‰∏≠ËÆæÁΩÆ receiver
# receiver ‰ºö‰Ωú‰∏∫ÈÄöÁü•Á≥ªÁªüÁöÑ user_id
receiver: ops-team

# ÊàñËÄÖÈíàÂØπ‰∏çÂêåÂõ¢Èòü
receiver: dev-team
receiver: security-team`}
                                </pre>
                            </div>
                            
                            <div>
                                <h5 className="font-medium mb-2">ÊîØÊåÅÁöÑÂäüËÉΩ</h5>
                                <div className="grid md:grid-cols-2 gap-2">
                                    <div className="flex items-center gap-2">
                                        <Icon name="check-circle" className="text-green-600" />
                                        <span>Â§öÂëäË≠¶ÊâπÈáèÂèëÈÄÅ</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <Icon name="check-circle" className="text-green-600" />
                                        <span>Firing Âíå Resolved Áä∂ÊÄÅ</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <Icon name="check-circle" className="text-green-600" />
                                        <span>Ëá™ÂÆö‰πâÊ®°ÊùøÊîØÊåÅ</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <Icon name="check-circle" className="text-green-600" />
                                        <span>Â§öÊ∏†ÈÅìÂêåÊó∂ÂèëÈÄÅ</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <Icon name="check-circle" className="text-green-600" />
                                        <span>ÂØåÊñáÊú¨Ê†ºÂºèÂåñ</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <Icon name="check-circle" className="text-green-600" />
                                        <span>ÂëäË≠¶ÂàÜÁªÑÂíåËÅöÂêà</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>